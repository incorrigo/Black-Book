<!-- PeopleManager.xaml -->
<UserControl x:Class="BlackBook.Views.PeopleManager"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:conv="clr-namespace:BlackBook.Converters"
             MinWidth="300">
    <UserControl.Resources>
        <!-- Converter to get Company Name from CompanyId -->
        <conv:CompanyNameConverter x:Key="CompanyNameConverter" />
        <!-- Relationship glyph converter already defined in Converters, assume as StaticResource if App.xaml merges it -->
        <!-- If not, we could define another instance here similarly: -->
        <!-- <conv:RelationshipGlyphConverter x:Key="RelationshipGlyphConverter" /> -->
    </UserControl.Resources>
    <Grid Margin="8">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="2*"/>
            <!-- People list column -->
            <ColumnDefinition Width="3*"/>
            <!-- Details column -->
        </Grid.ColumnDefinitions>

        <!-- Master list of people -->
        <ListView x:Name="PeopleList" Grid.Column="0"
                  ItemsSource="{Binding People}" 
                  SelectedIndex="0" SelectionMode="Single"
                  MinWidth="100" Margin="0 0 8 0">
            <!-- Each Person item tooltip shows email -->
            <ListView.ItemContainerStyle>
                <Style TargetType="ListViewItem">
                    <Setter Property="ToolTip" Value="{Binding Email}"/>
                </Style>
            </ListView.ItemContainerStyle>
            <ListView.View>
                <GridView>
                    <!-- Relationship glyph column -->
                    <GridViewColumn Width="20">
                        <GridViewColumn.CellTemplate>
                            <DataTemplate>
                                <TextBlock FontSize="14" HorizontalAlignment="Center"
                                           Text="{Binding Relationship, Converter={StaticResource RelationshipGlyphConverter}}"/>
                            </DataTemplate>
                        </GridViewColumn.CellTemplate>
                    </GridViewColumn>
                    <!-- Name column -->
                    <GridViewColumn Header="Name" Width="120" DisplayMemberBinding="{Binding Name}" />
                    <!-- Company column (uses converter to display name instead of ID) -->
                    <GridViewColumn Header="Company" Width="100">
                        <GridViewColumn.CellTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding CompanyId, Converter={StaticResource CompanyNameConverter}}"/>
                            </DataTemplate>
                        </GridViewColumn.CellTemplate>
                    </GridViewColumn>
                </GridView>
            </ListView.View>
        </ListView>

        <!-- Details pane for selected person -->
        <Border Grid.Column="1" Padding="12" BorderThickness="1" BorderBrush="#AAA">
            <StackPanel>
                <!-- Name -->
                <TextBlock FontSize="18" FontWeight="Bold"
                           Text="{Binding ElementName=PeopleList, Path=SelectedItem.Name}" />
                <!-- Person ID (subtle) -->
                <TextBlock FontSize="10" Foreground="Gray"
                           Text="{Binding ElementName=PeopleList, Path=SelectedItem.Id}" />
                <!-- Company name (and ID in tooltip) -->
                <TextBlock FontStyle="Italic" Foreground="Black"
                           Text="{Binding ElementName=PeopleList, Path=SelectedItem.CompanyId, Converter={StaticResource CompanyNameConverter}}">
                    <TextBlock.ToolTip>
                        <ToolTip Content="{Binding ElementName=PeopleList, Path=SelectedItem.CompanyId}" />
                    </TextBlock.ToolTip>
                </TextBlock>
                <!-- Email -->
                <TextBlock Foreground="Black">
                    <Run Text="Email: "/>
                    <Run Text="{Binding ElementName=PeopleList, Path=SelectedItem.Email, TargetNullValue='N/A'}"/>
                </TextBlock>
                <!-- Phone -->
                <TextBlock Foreground="Black" Margin="0 2 0 0">
                    <Run Text="Phone: "/>
                    <Run Text="{Binding ElementName=PeopleList, Path=SelectedItem.PhoneNumber, TargetNullValue='N/A'}"/>
                </TextBlock>
                <!-- Relationship status text -->
                <TextBlock Foreground="Black" Margin="0 2 0 0">
                    <Run Text="Relationship: "/>
                    <Run Text="{Binding ElementName=PeopleList, Path=SelectedItem.Relationship}" />
                </TextBlock>
                <!-- Involved Situations list -->
                <TextBlock Margin="0 12 0 4" FontStyle="Italic" Text="Involved in:"/>
                <ListBox ItemsSource="{Binding ElementName=PeopleList, Path=SelectedItem.Situations}"
                         DisplayMemberPath="Title" 
                         ToolTip="Situations this person is involved in"/>
            </StackPanel>
        </Border>
    </Grid>
</UserControl>
